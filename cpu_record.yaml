##########################################
#
# cpu_record.yaml
#
# A config which allows for the recording of one
# stream of testDataGen
# Author: Calvin Leung
##########################################
---
type: config
# Logging level can be one of:
# OFF, ERROR, WARN, INFO, DEBUG, DEBUG2 (case insensitive)
# Note DEBUG and DEBUG2 require a build with (-DCMAKE_BUILD_TYPE=Debug)
log_level: DEBUG

# Note that for ADC mode the "samples" variable
# doesn't really make sense here.  Since there are
# 2048 ADC samples in the 2.56 us the other modes consider to be a "sample"
samples_per_data_set: 65536
buffer_depth: 10 # keep at least N-10 frames in buffer before overwriting old data
num_elements: 256 #correlator inputs; change back to 2048
block_size: 2 
baseband_buffer_depth: 50 # 10 frames per 1% of CPU (1x Intel Xeon 4116)
cpu_affinity: [2,3,4,5,6,7]
#num_disks: 10
#instrument_name: chime
num_local_freq: 1 # number of frequencies PER STREAM. 8 for new pathfinder, 1 for current CHIME

# Pool
main_pool:
    kotekan_metadata_pool: chimeMetadata
    num_metadata_objects: 30 * buffer_depth + 5 * baseband_buffer_depth

# Buffers
gpu_input_buffers:
    num_frames: baseband_buffer_depth
    frame_size: samples_per_data_set * num_elements
    metadata_pool: main_pool
    gpu_input_buffer_0:
        kotekan_buffer: standard
        numa_node: 0

lost_samples_buffer:
    num_frames: baseband_buffer_depth
    frame_size: samples_per_data_set
    metadata_pool: main_pool
    lost_samples_buffer_0:
        kotekan_buffer: standard
        numa_node: 0

gen_data:
    type: random
    value: 153
    gen_data_0:
        kotekan_stage: testDataGen
        stream_id: 1
        network_out_buf: gpu_input_buffer_0
        out_buf: gpu_input_buffer_0
        lost_samples_buf: lost_samples_buffer_0

baseband:
    max_dump_samples: 40000
    num_frames_buffer: baseband_buffer_depth - 10
    base_dir: /home/masuilab/temp/
    write_throttle: 0
    kotekan_stage: basebandReadout
    in_buf: gpu_input_buffer_0
